doctype html
html
  head
    meta(http-equiv='Content-type', content='text/html; charset=utf-8')
    meta(name='viewport', content='width=device-width,initial-scale=1')
    title PICKING MATERIAL
    link(rel='shortcut icon', type='image/png', href='/media/images/favicon.png')
    //link(rel='alternate', type='application/rss+xml', title='RSS 2.0', href='http://www.datatables.net/rss.xml')
    link(href='/css/bootstrap.css', rel='stylesheet')
    style(type='text/css')
     body {
     padding-top: 30px;
     padding-bottom: 40px;
     }
     .sidebar-nav {
     padding: 9px 0;
     background-color:#3333ff
     }
     .navbar {
     background-color:#3333ff
     }
     table {
        border-collapse: collapse;
     }
     table, th, td {
            border: 1px solid black;
     }
     input{
        width: 150px
    }
    //link(rel='stylesheet', type='text/css', href='https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css')//ok
    //- link(rel='stylesheet', type='text/css', href='/css/jquery.dataTables.min.css')
    script(type='text/javascript', language='javascript', src='/js/jquery-1.12.4.min.js')
    //script(type='text/javascript', language='javascript', src='//code.jquery.com/jquery-1.12.4.js')//ok
    //script(type='text/javascript', language='javascript', src='https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js')//OK
    //-script(type='text/javascript', language='javascript', src='/js/jquery.dataTables.js')
    //script(type='text/javascript', language='javascript', src='/js/jquery.dataTables.min.js')
    //script(type="text/javascript", src="http://d3js.org/d3.v3.min.js") //ok
    script(type="text/javascript", src="/js/d3.v4.min.js") 

    //- script(type="text/javascript", src="/js/dataTables.pageResize.min.js") 
    
    link(href='/css/select2.min.css', rel='stylesheet')
    script(src='/js/select2.min.js')
    



    
    script(type='text/javascript', language='javascript', src='/js/url2id.js')
    //- script.init(type='text/javascript').
   
 body.wide.comments.example
   .navbar.navbar-inverse.navbar-fixed-top
           .navbar-inner
             .container-fluid
               a.btn.btn-navbar(data-toggle='collapse', data-target='.nav-collapse', )
                 span.icon-bar
                 span.icon-bar
                 span.icon-bar
               a.brand(href='') MATERIAL PICKING BY TO
               .nav-collapse.collapse
                 //p.navbar-text.pull-right
                 //  | Logged in as
                 //  a.navbar-link(href='#') Username
                 ul.nav
                   li.active
                     a(href='/') 
                
 
   .container-fluid
    .row-fluid
     .span6      
            input#op(type="text", placeholder="Operator code.", onkeydown=`goNext(this,"order");`)
            input#order(type="text", value='3265707', placeholder="Transfer Order", onkeydown=`LoadTable(this,"check1");`)
     .span4
            a.btn.btn-primary.btn-medium(onclick="loadTabletodo();") TO# TODO
            a.btn.btn-primary.btn-small(onclick="loadTableall();") TO# ALL
            a.btn.btn-primary.btn-small(onclick="order.value='';document.getElementById('order').focus();") Clear TO#
  .container-fluid
    .row-fluid
     .span6
          input#check1(type="text", placeholder="1-Scan trên TO", onkeydown=`goLoadandNext(this,"check2")`)
          input#check2(type="text", placeholder="2-Scan trên Thùng", onkeydown=`goLoadandNext(this,"check3")`)
          input#check3(type="text", placeholder="3-Scan trên Nhãn", onkeydown=`goLoadandNext(this,"check1")`)
     .span6
        a.btn.btn-primary.btn-large(onclick='verify()') Confirm PickMaterial Done»

   .row-fluid
     .span12
       table#TOview.display(cellspacing='0', width='100%')
   script.
    $(document).ready(function () {
        document.getElementById('op').focus();
       
    });
    
    var count =0;
    var mainval ='';
    function getMainVal(){
        if (count ==0) {
            
            mainval=check.value;
            console.log('get mianvalue', mainval);
        }
    }
    function getValforCheck(){
        getMainVal(); //start pick with mainvalue set
        if(count <3 && check.value != '')
        {
            if (check.value==mainval){
                check.value='';
                count +=count; //+1
                console.log('rs',check.value,count);
        }
            
            

        }
    }
    function verify() {
        DienCodeNV();
        if (check1.value==check2.value&&check1.value==check3.value){

       

        let to= order.value;
        let mat= check1.value;
        let code= op.value;
        let qty= 0;


        buildHtmlTable(`/sql/localhost/exec Pickpack.dbo.pp020_amevn_ConsumedMatAtTO '${to}','${mat}','${code}','${qty}'`,`#TOview`);  
        


        check1.value='';
        check2.value='';
        check3.value='';
        document.getElementById("check1").focus();
         }
         else
         {
             alert('Kiểm tra thông tin nhận bị sai!')
         }
    }
    var goNext= function(ele, nextinput) {
      if(event.keyCode == 13) {
          //alert(ele.value);        
          if (ele.value=="") {
           alert("Please input info");
           document.getElementById(ele).focus();
           }
          else {
           document.getElementById(nextinput).focus();
          }
      }
    }
    function DienCodeNV(){
        if (op.value =='')
            {
                alert('Điền Code Nhân viên trước!');
                document.getElementById('op').focus();
                return;
            }
    }
    var goLoadandNext= function(ele, nextinput) {
      if(event.keyCode == 13) {
          //alert(ele.value);        
          if (ele.value=="") {
           alert("Please input info");
           }
          else {
            let to= order.value;
            
           document.getElementById(nextinput).focus();
          }
          
        
          
      }
    }

    function LoadTable(ele,nextinput){
        if(event.keyCode == 13) {
            
          //alert(ele.value);        
          if (ele.value=="") {
           alert("Please input info");
           }
          else {
              DienCodeNV();
            let to= order.value;
            buildHtmlTable(`/sql/localhost/exec Pickpack.dbo.[pp010_amevn_LoadTO] '${to}'`,`#TOview`);  
            document.getElementById(nextinput).focus();
          }
      }
        
    }
    

    function loadTabletodo(){
            if(1==1) {
             {  DienCodeNV();
                let to= order.value;
                buildHtmlTable(`/sql/localhost/exec Pickpack.dbo.[pp010_amevn_LoadTO] '${to}'`,`#TOview`);  
                
            }
        } 
    }

    function loadTableall(){
            if(1==1) {
             {
                DienCodeNV();
                let to= order.value;
                buildHtmlTable(`/sql/localhost/exec Pickpack.dbo.[pp010_amevn_LoadTO] '${to}',1`,`#TOview`);  
                
            }
        } 
    }
 

   
   
    
   
  
